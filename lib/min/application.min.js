var $$={trimFromStart:function(a,b){var c=_(a).toString();return c.substring(0,b)},trimFromEnd:function(a,b){var c=_(a).toString(),d=c.length-b;return c.substring(d,d+b)},roundDecimal:function(a,b){var c=+(Math.round(+(a+"e+"+b))+("e-"+b));return _.isNaN(c)?Math.round(a):c},toRational:function(a,b){for(var c=a,d=Math.floor(c),e=[d,1],f=[1,0];c-d>b*f[0]*f[0];)c=1/(c-d),d=Math.floor(c),e[2]=e[1],f[2]=f[1],e[1]=e[0],f[1]=f[0],e[0]=e[2]+d*e[1],f[0]=f[2]+d*f[1];return e[0]+"/"+f[0]}},Converter;!function(a){"use strict";Converter=function(a){this.conversions=a,this.unitType=null},a.extend(Converter.prototype,{getUnitTypes:function(){return a.mapValues(this.conversions,function(a){return{label:a.name,"default":a.default}})},getUnit:function(a){return this.getUnits()[a]},getDefaultFromUnit:function(){return this.getUnitTypes()[this.getUnitType()].default[0]},getDefaultToUnit:function(){return this.getUnitTypes()[this.getUnitType()].default[1]},getUnits:function(b){return b=b||this.getUnitType(),a.mapValues(this.conversions[b].units,function(a){return{label:a.name,symbol:a.symbol}})},setUnitType:function(a){if(void 0===this.conversions[a])throw"unknown type";this.unitType=a},getUnitType:function(){return this.unitType},convertAll:function(b,c){var d=this;return a.mapValues(this.conversions[this.getUnitType()].units,function(a,e){return e===c?null:{label:a.name,symbol:a.symbol,value:d.convert(b,c,e)}})},convert:function(b,c,d){var e=this.tryConvert(b,c,d,[]);if(a.isNull(e))throw"No way to convert "+c+" to "+d;return e},tryConvert:function(b,c,d,e){var f=this,g=this.conversions[this.getUnitType()].units,h=c+":"+d,i=null;if(a.isUndefined(g[c]))throw"Unknown 'from' unit "+c+" of type "+this.getUnitType();if(a.isUndefined(g[d]))throw"Unknown 'to' unit "+d+" of type "+this.getUnitType();return c===d?b:a.contains(e,h)?null:(e.push(h),a.isUndefined(g[c].conv[d])?(a.forOwn(g[c].conv,function(c,g){return i=f.tryConvert(b*c,g,d,e),a.isNull(i)}),i):b*g[c].conv[d])}})}(window._);var CategoryMenu;!function(a,b){"use strict";CategoryMenu=function(b,c){this.el=b,this.$el=a(b),this.items=c,this.init()},b.extend(CategoryMenu.prototype,{init:function(){b.bindAll(this,"_handleCategoryClick");var a=this;a.ui={nav:a.$el.find("nav"),list:a.$el.find("ul")},a._renderItems(),a.ui.nav.find("button").hammer().on({tap:a._handleCategoryClick})},_renderItems:function(){var a=this;b.each(b.keys(a.items),function(b){a.ui.list.append('<li><button type="button" data-unit-type="'+b+'">'+a.items[b].label+"</button></li>")})},clearActive:function(){this.$el.find(".active").removeClass("active")},setActive:function(a){this.clearActive(),this.$el.find('button[data-unit-type="'+a+'"]').closest("li").addClass("active")},getActive:function(){return this.ui.nav.find(".active button").attr("data-unit-type")},_handleCategoryClick:function(b){this.$el.trigger("click:item",a(b.currentTarget).attr("data-unit-type"))}})}(jQuery,window._);var ConversionWindow;!function(a,b,c){"use strict";ConversionWindow=function(b){this.el=b,this.$el=a(b),this.init()},b.extend(ConversionWindow.prototype,{init:function(){b.bindAll(this,"backspace","_handleFromUnitTap","_handleToUnitTap");var a=this;a.ui={from:a.$el.find(".convert-from"),to:a.$el.find(".convert-to")},a.ui.from.hammer({swipe_velocity:.3}).on({swipeleft:a.backspace}),a.ui.from.hammer().on({tap:a._handleFromUnitTap}),a.ui.to.hammer().on({tap:a._handleToUnitTap})},_scaleFont:function(a){a=a.find(".value"),a.text().length>6?a.toggleClass("small",!0):a.toggleClass("small",!1)},getFromValue:function(a){return a?Number(this.ui.from.find(".value").text()):this.ui.from.find(".value").text()},setFromValue:function(a,b){this.ui.from.find(".value").text(c.trimFromStart(a,13)),this._scaleFont(this.ui.from),b||this.triggerChange()},getFromUnit:function(){return this.ui.from.find(".unit").attr("data-unit")},setFromUnit:function(a,b){this.ui.from.find(".unit").text(b.symbol).attr("data-unit",a)},setToValue:function(a){this.ui.to.find(".value").text(c.trimFromStart(a,13)),this._scaleFont(this.ui.to)},getToUnit:function(){return this.ui.to.find(".unit").attr("data-unit")},setToUnit:function(a,b){this.ui.to.find(".unit").text(b.symbol).attr("data-unit",a)},triggerChange:function(){this.$el.trigger("change:fromValue",this.getFromValue())},backspace:function(){this.getFromValue().length>1?this.setFromValue(c.trimFromStart(this.getFromValue(),this.getFromValue().length-1)):this.$el.trigger("clear:fromValue")},_handleFromUnitTap:function(){this.$el.trigger("choose:from:unit")},_handleToUnitTap:function(){this.$el.trigger("choose:to:unit")}})}(jQuery,window._,window.$$);var Calculator;!function(a,b){"use strict";Calculator=function(b){this.el=b,this.$el=a(b),this.init()},b.extend(Calculator.prototype,{init:function(){b.bindAll(this,"_handleEvaluateClick","_handleDigitClick","_handleFunctionClick","_handleOperatorClick");var a=this;a.$el.find(".digit").hammer().on({touch:a._handleDigitClick}),a.$el.find(".function").hammer().on({touch:a._handleFunctionClick}),a.$el.find(".operator").hammer().on({touch:a._handleOperatorClick}),a.$el.find(".evaluate").hammer().on({touch:a._handleEvaluateClick})},removeHighlight:function(){this.$el.find(".highlighted").removeClass("highlighted")},evaluate:function(){this.$el.trigger("evaluate")},_handleEvaluateClick:function(){this.removeHighlight(),this.evaluate()},_handleDigitClick:function(b){this.removeHighlight(),a(b.currentTarget).hasClass("decimal")?this.$el.trigger("decimal"):this.$el.trigger("digit",Number(a(b.currentTarget).text()))},_handleFunctionClick:function(b){var c=a(b.currentTarget).attr("data-func");switch(c){case"percent":this.$el.trigger("percent");break;case"clear":this.removeHighlight(),this.$el.trigger("clear");break;case"inverse":this.$el.trigger("invert");break;default:console.log("No handler set for function: "+c)}},_handleOperatorClick:function(b){this.$el.find(".highlighted").length>0&&(this.$el.trigger("new:operation"),this.removeHighlight()),a(b.currentTarget).addClass("highlighted"),this.$el.trigger(a(b.currentTarget).attr("data-operation"))}})}(jQuery,window._);var UnitPicker;!function(a,b){"use strict";UnitPicker=function(b){this.units=b,this.$el=a('<div class="unit-picker" style="display: none;" />'),this.init()},b.extend(UnitPicker.prototype,{init:function(){b.bindAll(this,"_handleUnitTap"),this._renderUnits()},_renderUnits:function(){var a=this;b.each(b.keys(a.units),function(b){a.$el.append('<li><button type="button" data-symbol="'+a.units[b].symbol+'" data-unit="'+b+'">'+a.units[b].label+"</button></li>")}),a.$el.wrapInner("<nav><ul /></nav>")},show:function(){var a=this;a.$el.find("button").hammer().on({tap:a._handleUnitTap}),a.$el.fadeIn(300)},destroy:function(){var a=this;a.$el.fadeOut(100,function(){a.$el.remove()})},clearActive:function(){this.$el.find(".active").removeClass("active")},setActive:function(a){this.$el.find('[data-unit="'+a+'"]').closest("li").addClass("active")},_handleUnitTap:function(b){this.clearActive(),this.setActive(a(b.currentTarget).attr("data-symbol")),this.$el.trigger("new:unit",a(b.currentTarget).attr("data-unit"))}})}(jQuery,window._);var App;!function(a,b,c,d,e,f,g,h){"use strict";App=function(b){this.el=b,this.$el=a(b)},b.extend(App.prototype,{init:function(){b.bindAll(this,"_handleToggleClick","_handleSwipeLeft","_handleSwipeRight","updateUnitType","_handleMenuItemClick","_handlePercent","_handleDigit","_handleDecimal","_handleClear","_handleInvert","_handleAdd","_handleSubtract","_handleDivide","_handleMultiply","_handleEvaluate","updateConversions","_handleChooseFromUnit","_handleChooseToUnit");var a=this;a.ui={toggle:a.$el.find(".toggle"),menu:a.$el.find(".unit-category"),conversions:a.$el.find(".conversions"),calc:a.$el.find(".calc"),stage:a.$el.find(".stage")},a.converter=new c(g),a.menu=new d(this.ui.menu[0],this.converter.getUnitTypes()),a.conversion=new e(this.ui.conversions[0]),a.calc=new f(this.ui.calc[0]),a.silentClear=!0,a.silentDigit=!1,a.ui.toggle.hammer().on({tap:a._handleToggleClick}),a.$el.find(".stage").hammer().on({dragleft:a._handleSwipeLeft,dragright:a._handleSwipeRight}),a.menu.$el.bind({"click:item":a._handleMenuItemClick}),a.conversion.$el.bind({"change:fromValue":a.updateConversions,"clear:fromValue":a._handleClear,"choose:from:unit":a._handleChooseFromUnit,"choose:to:unit":a._handleChooseToUnit}),a.calc.$el.bind({digit:a._handleDigit,decimal:a._handleDecimal,percent:a._handlePercent,clear:a._handleClear,invert:a._handleInvert,add:a._handleAdd,subtract:a._handleSubtract,divide:a._handleDivide,multiply:a._handleMultiply,evaluate:a._handleEvaluate}),this.updateUnitType(b.first(b.keys(this.converter.getUnitTypes())))},getSilentClear:function(){return this.silentClear},setSilentClear:function(a){this.silentClear=a},getSilentDigit:function(){return this.silentDigit},setSilentDigit:function(a){this.silentDigit=a},toggleOpen:function(a){b.isUndefined(a)&&(a=!this.isOpen()),this.$el.toggleClass("menu-open",a)},isOpen:function(){return this.$el.hasClass("menu-open")},updateConversions:function(){console.log("Convert "+this.conversion.getFromValue(!0)+" "+this.conversion.getFromUnit()+" to "+this.conversion.getToUnit()),console.log("Rational: "+$$.toRational($$.roundDecimal(this.conversion.getFromValue(!0),10),1e-10));var a=this.converter.convert(this.conversion.getFromValue(!0),this.conversion.getFromUnit(),this.conversion.getToUnit());this.conversion.setToValue($$.roundDecimal(a,4))},updateUnitType:function(a){this.toggleOpen(!1),this.converter.setUnitType(a),this.menu.setActive(this.converter.getUnitType()),this.conversion.setFromUnit(this.converter.getDefaultFromUnit(),this.converter.getUnit(this.converter.getDefaultFromUnit())),this.conversion.setToUnit(this.converter.getDefaultToUnit(),this.converter.getUnit(this.converter.getDefaultToUnit())),this._handleClear()},_operationPrep:function(){this.calc.evaluate(),this.setSilentClear(!0),this.setSilentDigit(!0)},_handleToggleClick:function(){this.toggleOpen()},_handleSwipeLeft:function(){this.toggleOpen(!1)},_handleSwipeRight:function(){this.toggleOpen(!0)},_handleMenuItemClick:function(a,b){this.updateUnitType(b)},_handleDigit:function(a,b){var c=this.getSilentClear()?b:this.conversion.getFromValue()+b;this.conversion.setFromValue(c,this.getSilentDigit()),this.setSilentClear(!1)},_handleDecimal:function(){-1===this.conversion.getFromValue().indexOf(".")?this.conversion.setFromValue(this.conversion.getFromValue()+".",this.getSilentDigit()):this.getSilentClear()&&this.conversion.setFromValue("0.",this.getSilentDigit()),this.setSilentClear(!1)},_handlePercent:function(){this.conversion.setFromValue(this.conversion.getFromValue(!0)/100)},_handleClear:function(){this.calc.evaluate(),this.conversion.setFromValue(0,this.getSilentDigit()),this.setSilentClear(!0),this.setSilentDigit(!1)},_handleChooseFromUnit:function(){var a=this,b=new h(a.converter.getUnits());b.$el.one("new:unit",function(c,d){console.log(d),console.log(a.converter.getUnits()[d]),a.conversion.setFromUnit(d,a.converter.getUnits()[d]),a.updateConversions(),b.destroy()}),b.setActive(a.conversion.getFromUnit()),a.$el.prepend(b.$el),b.show()},_handleChooseToUnit:function(){var a=this,b=new h(a.converter.getUnits());b.$el.one("new:unit",function(c,d){a.conversion.setToUnit(d,a.converter.getUnits()[d]),a.updateConversions(),b.destroy()}),b.setActive(a.conversion.getToUnit()),a.$el.prepend(b.$el),b.show()},_handleInvert:function(){0===this.conversion.getFromValue(!0)?this.conversion.setFromValue("-",!0):this.conversion.setFromValue(-1*this.conversion.getFromValue(!0),this.getSilentDigit()),this.setSilentClear(!1)},_handleAdd:function(){this._operationPrep();var a=this,b=a.conversion.getFromValue(!0);a.calc.$el.one("new:operation clear",function(){a.calc.$el.off("evaluate")}),a.calc.$el.one("evaluate",function(){a.calc.$el.off("new:operation"),a.setSilentDigit(!1),a.conversion.setFromValue(b+a.conversion.getFromValue(!0),a.getSilentDigit())})},_handleSubtract:function(){this._operationPrep();var a=this,b=a.conversion.getFromValue(!0);a.calc.$el.one("new:operation clear",function(){a.calc.$el.off("evaluate")}),a.calc.$el.one("evaluate",function(){a.setSilentDigit(!1),a.conversion.setFromValue(b-a.conversion.getFromValue(!0),a.getSilentDigit())})},_handleDivide:function(){this._operationPrep();var a=this,b=a.conversion.getFromValue(!0);b=a.conversion.getFromValue(!0),a.calc.$el.one("new:operation clear",function(){a.calc.$el.off("evaluate")}),a.calc.$el.one("evaluate",function(){a.setSilentDigit(!1),a.conversion.setFromValue(b/a.conversion.getFromValue(!0),a.getSilentDigit())})},_handleMultiply:function(){this._operationPrep();var a=this,b=a.conversion.getFromValue(!0);a.calc.$el.one("new:operation clear",function(){a.calc.$el.off("evaluate")}),a.calc.$el.one("evaluate",function(){a.setSilentDigit(!1),a.conversion.setFromValue(b*a.conversion.getFromValue(!0),a.getSilentDigit())})},_handleEvaluate:function(){this.setSilentClear(!0),this.setSilentDigit(!1)}})}(jQuery,window._,window.Converter,window.CategoryMenu,window.ConversionWindow,window.Calculator,window.Conversions,window.UnitPicker);var app;!function(a){"use strict";var b=navigator.userAgent,c=b.match(/(iPad|iPhone|iPod)/g)?!0:!1,d=!b.match(/Safari/i)||b.match(/Chrome/i)||b.match(/CriOS/i)?!1:!0;a(document).ready(function(){!window.navigator.standalone&&c?d||a("#install .message").html("You must be using Safari to install <strong>thistothat</strong>"):a("#install").remove(),a("body").bind({touchmove:function(a){a.preventDefault()}}),a("#install").remove(),app=new App(a("body")[0]),app.init()})}(window.jQuery);